{"changed":true,"filter":false,"title":"carts_controller.rb","tooltip":"/app/controllers/carts_controller.rb","value":"class CartsController < ApplicationController\n  before_action :authenticate_user!\n\n  def show\n    cart_ids = $redis.smembers current_user_cart\n    @cart_produces = Produce.find(cart_ids)\n  end\n\n  def add\n    $redis.sadd current_user_cart, params[:produce_id]\n    render json: current_user.cart_count, status: 200\n  end\n\n  def remove\n    $redis.srem current_user_cart, params[:produce_id]\n    render json: current_user.cart_count, status: 200\n  end\n\n  private\n\n  def current_user_cart\n    \"cart#{current_user.id}\"\n  end\nend","undoManager":{"mark":13,"position":19,"stack":[[{"start":{"row":22,"column":5},"end":{"row":23,"column":0},"action":"insert","lines":["",""],"id":138},{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":23,"column":2},"end":{"row":34,"column":3},"action":"insert","lines":["def current_cart ","  cart = Cart.find(session[:cart_id])","  unless cart.active?","    cart = Cart.create","    session[:cart_id] = cart.id","  end","  cart","rescue ActiveRecord::RecordNotFound","  cart = Cart.create","  session[:cart_id] = cart.id","  cart","end"],"id":139}],[{"start":{"row":22,"column":5},"end":{"row":23,"column":0},"action":"insert","lines":["",""],"id":140},{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":25,"column":9},"end":{"row":25,"column":13},"action":"remove","lines":["Cart"],"id":141},{"start":{"row":25,"column":9},"end":{"row":25,"column":10},"action":"insert","lines":["P"]}],[{"start":{"row":25,"column":10},"end":{"row":25,"column":11},"action":"insert","lines":["r"],"id":142}],[{"start":{"row":25,"column":11},"end":{"row":25,"column":12},"action":"insert","lines":["o"],"id":143}],[{"start":{"row":25,"column":12},"end":{"row":25,"column":13},"action":"insert","lines":["d"],"id":144}],[{"start":{"row":25,"column":13},"end":{"row":25,"column":14},"action":"insert","lines":["u"],"id":145}],[{"start":{"row":25,"column":14},"end":{"row":25,"column":15},"action":"insert","lines":["c"],"id":146}],[{"start":{"row":25,"column":15},"end":{"row":25,"column":16},"action":"insert","lines":["e"],"id":147}],[{"start":{"row":24,"column":0},"end":{"row":35,"column":3},"action":"remove","lines":["  def current_cart ","  cart = Produce.find(session[:cart_id])","  unless cart.active?","    cart = Cart.create","    session[:cart_id] = cart.id","  end","  cart","rescue ActiveRecord::RecordNotFound","  cart = Cart.create","  session[:cart_id] = cart.id","  cart","end"],"id":166}],[{"start":{"row":23,"column":2},"end":{"row":24,"column":0},"action":"remove","lines":["",""],"id":167}],[{"start":{"row":22,"column":5},"end":{"row":23,"column":0},"action":"insert","lines":["",""],"id":168},{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":23,"column":2},"end":{"row":24,"column":0},"action":"insert","lines":["",""],"id":172},{"start":{"row":24,"column":0},"end":{"row":24,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":24,"column":0},"end":{"row":24,"column":2},"action":"remove","lines":["  "],"id":175}],[{"start":{"row":23,"column":2},"end":{"row":24,"column":0},"action":"remove","lines":["",""],"id":176}],[{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"remove","lines":["  "],"id":177}],[{"start":{"row":22,"column":5},"end":{"row":23,"column":0},"action":"remove","lines":["",""],"id":178}],[{"start":{"row":23,"column":0},"end":{"row":23,"column":1},"action":"remove","lines":[" "],"id":179}],[{"start":{"row":22,"column":5},"end":{"row":23,"column":1},"action":"remove","lines":[""," "],"id":180}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":22,"column":5},"end":{"row":22,"column":5},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":37,"mode":"ace/mode/ruby"}},"timestamp":1493837944325}